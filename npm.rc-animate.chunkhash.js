(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{246:function(n,e,t){"use strict";var r=t(42),i=t.n(r),o=t(169),a=t.n(o),s=t(165),p=t.n(s),c=t(168),l=t.n(c),u=t(166),h=t.n(u),f=t(167),v=t.n(f),y=t(0),d=t.n(y),m=t(11),k=t.n(m);function E(n){var e=[];return d.a.Children.forEach(n,function(n){e.push(n)}),e}function A(n,e){var t=null;return n&&n.forEach(function(n){t||n&&n.key===e&&(t=n)}),t}function L(n,e,t){var r=null;return n&&n.forEach(function(n){if(n&&n.key===e&&n.props[t]){if(r)throw new Error("two child with same key for <rc-animate> children");r=n}}),r}var b=t(12),w=t.n(b),g=t(249),P={isAppearSupported:function(n){return n.transitionName&&n.transitionAppear||n.animation.appear},isEnterSupported:function(n){return n.transitionName&&n.transitionEnter||n.animation.enter},isLeaveSupported:function(n){return n.transitionName&&n.transitionLeave||n.animation.leave},allowAppearCallback:function(n){return n.transitionAppear||n.animation.appear},allowEnterCallback:function(n){return n.transitionEnter||n.animation.enter},allowLeaveCallback:function(n){return n.transitionLeave||n.animation.leave}},T={enter:"transitionEnter",appear:"transitionAppear",leave:"transitionLeave"},C=function(n){function e(){return p()(this,e),h()(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return v()(e,n),l()(e,[{key:"componentWillUnmount",value:function(){this.stop()}},{key:"componentWillEnter",value:function(n){P.isEnterSupported(this.props)?this.transition("enter",n):n()}},{key:"componentWillAppear",value:function(n){P.isAppearSupported(this.props)?this.transition("appear",n):n()}},{key:"componentWillLeave",value:function(n){P.isLeaveSupported(this.props)?this.transition("leave",n):n()}},{key:"transition",value:function(n,e){var t=this,r=w.a.findDOMNode(this),i=this.props,o=i.transitionName,a="object"==typeof o;this.stop();var s=function(){t.stopper=null,e()};if((g.b||!i.animation[n])&&o&&i[T[n]]){var p=a?o[n]:o+"-"+n,c=p+"-active";a&&o[n+"Active"]&&(c=o[n+"Active"]),this.stopper=Object(g.a)(r,{name:p,active:c},s)}else this.stopper=i.animation[n](r,s)}},{key:"stop",value:function(){var n=this.stopper;n&&(this.stopper=null,n.stop())}},{key:"render",value:function(){return this.props.children}}]),e}(d.a.Component);C.propTypes={children:k.a.any};var K=C,N="rc_animate_"+Date.now();function O(n){var e=n.children;return d.a.isValidElement(e)&&!e.key?d.a.cloneElement(e,{key:N}):e}function R(){}var _=function(n){function e(n){p()(this,e);var t=h()(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return j.call(t),t.currentlyAnimatingKeys={},t.keysToEnter=[],t.keysToLeave=[],t.state={children:E(O(n))},t.childrenRefs={},t}return v()(e,n),l()(e,[{key:"componentDidMount",value:function(){var n=this,e=this.props.showProp,t=this.state.children;e&&(t=t.filter(function(n){return!!n.props[e]})),t.forEach(function(e){e&&n.performAppear(e.key)})}},{key:"componentWillReceiveProps",value:function(n){var e=this;this.nextProps=n;var t=E(O(n)),r=this.props;r.exclusive&&Object.keys(this.currentlyAnimatingKeys).forEach(function(n){e.stop(n)});var i,o,s,p,c=r.showProp,l=this.currentlyAnimatingKeys,u=r.exclusive?E(O(r)):this.state.children,h=[];c?(u.forEach(function(n){var e=n&&A(t,n.key),r=void 0;(r=e&&e.props[c]||!n.props[c]?e:d.a.cloneElement(e||n,a()({},c,!0)))&&h.push(r)}),t.forEach(function(n){n&&A(u,n.key)||h.push(n)})):(i=t,o=[],s={},p=[],u.forEach(function(n){n&&A(i,n.key)?p.length&&(s[n.key]=p,p=[]):p.push(n)}),i.forEach(function(n){n&&Object.prototype.hasOwnProperty.call(s,n.key)&&(o=o.concat(s[n.key])),o.push(n)}),h=o=o.concat(p)),this.setState({children:h}),t.forEach(function(n){var t=n&&n.key;if(!n||!l[t]){var r=n&&A(u,t);if(c){var i=n.props[c];if(r)!L(u,t,c)&&i&&e.keysToEnter.push(t);else i&&e.keysToEnter.push(t)}else r||e.keysToEnter.push(t)}}),u.forEach(function(n){var r=n&&n.key;if(!n||!l[r]){var i=n&&A(t,r);if(c){var o=n.props[c];if(i)!L(t,r,c)&&o&&e.keysToLeave.push(r);else o&&e.keysToLeave.push(r)}else i||e.keysToLeave.push(r)}})}},{key:"componentDidUpdate",value:function(){var n=this.keysToEnter;this.keysToEnter=[],n.forEach(this.performEnter);var e=this.keysToLeave;this.keysToLeave=[],e.forEach(this.performLeave)}},{key:"isValidChildByKey",value:function(n,e){var t=this.props.showProp;return t?L(n,e,t):A(n,e)}},{key:"stop",value:function(n){delete this.currentlyAnimatingKeys[n];var e=this.childrenRefs[n];e&&e.stop()}},{key:"render",value:function(){var n=this,e=this.props;this.nextProps=e;var t=this.state.children,r=null;t&&(r=t.map(function(t){if(null==t)return t;if(!t.key)throw new Error("must set key for <rc-animate> children");return d.a.createElement(K,{key:t.key,ref:function(e){n.childrenRefs[t.key]=e},animation:e.animation,transitionName:e.transitionName,transitionEnter:e.transitionEnter,transitionAppear:e.transitionAppear,transitionLeave:e.transitionLeave},t)}));var o=e.component;if(o){var a=e;return"string"==typeof o&&(a=i()({className:e.className,style:e.style},e.componentProps)),d.a.createElement(o,a,r)}return r[0]||null}}]),e}(d.a.Component);_.isAnimate=!0,_.propTypes={component:k.a.any,componentProps:k.a.object,animation:k.a.object,transitionName:k.a.oneOfType([k.a.string,k.a.object]),transitionEnter:k.a.bool,transitionAppear:k.a.bool,exclusive:k.a.bool,transitionLeave:k.a.bool,onEnd:k.a.func,onEnter:k.a.func,onLeave:k.a.func,onAppear:k.a.func,showProp:k.a.string,children:k.a.node},_.defaultProps={animation:{},component:"span",componentProps:{},transitionEnter:!0,transitionLeave:!0,transitionAppear:!1,onEnd:R,onEnter:R,onLeave:R,onAppear:R};var j=function(){var n=this;this.performEnter=function(e){n.childrenRefs[e]&&(n.currentlyAnimatingKeys[e]=!0,n.childrenRefs[e].componentWillEnter(n.handleDoneAdding.bind(n,e,"enter")))},this.performAppear=function(e){n.childrenRefs[e]&&(n.currentlyAnimatingKeys[e]=!0,n.childrenRefs[e].componentWillAppear(n.handleDoneAdding.bind(n,e,"appear")))},this.handleDoneAdding=function(e,t){var r=n.props;if(delete n.currentlyAnimatingKeys[e],!r.exclusive||r===n.nextProps){var i=E(O(r));n.isValidChildByKey(i,e)?"appear"===t?P.allowAppearCallback(r)&&(r.onAppear(e),r.onEnd(e,!0)):P.allowEnterCallback(r)&&(r.onEnter(e),r.onEnd(e,!0)):n.performLeave(e)}},this.performLeave=function(e){n.childrenRefs[e]&&(n.currentlyAnimatingKeys[e]=!0,n.childrenRefs[e].componentWillLeave(n.handleDoneLeaving.bind(n,e)))},this.handleDoneLeaving=function(e){var t=n.props;if(delete n.currentlyAnimatingKeys[e],!t.exclusive||t===n.nextProps){var r,i,o,a,s=E(O(t));if(n.isValidChildByKey(s,e))n.performEnter(e);else{var p=function(){P.allowLeaveCallback(t)&&(t.onLeave(e),t.onEnd(e,!1))};r=n.state.children,i=s,o=t.showProp,(a=r.length===i.length)&&r.forEach(function(n,e){var t=i[e];n&&t&&(n&&!t||!n&&t?a=!1:n.key!==t.key?a=!1:o&&n.props[o]!==t.props[o]&&(a=!1))}),a?p():n.setState({children:s},p)}}}};e.a=_}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcmMtYW5pbWF0ZS9lcy9DaGlsZHJlblV0aWxzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9yYy1hbmltYXRlL2VzL3V0aWwvYW5pbWF0ZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcmMtYW5pbWF0ZS9lcy9BbmltYXRlQ2hpbGQuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JjLWFuaW1hdGUvZXMvQW5pbWF0ZS5qcyJdLCJuYW1lcyI6WyJ0b0FycmF5Q2hpbGRyZW4iLCJjaGlsZHJlbiIsInJldCIsInJlYWN0X2RlZmF1bHQiLCJhIiwiQ2hpbGRyZW4iLCJmb3JFYWNoIiwiY2hpbGQiLCJwdXNoIiwiZmluZENoaWxkSW5DaGlsZHJlbkJ5S2V5Iiwia2V5IiwiZmluZFNob3duQ2hpbGRJbkNoaWxkcmVuQnlLZXkiLCJzaG93UHJvcCIsInByb3BzIiwiRXJyb3IiLCJhbmltYXRlIiwiaXNBcHBlYXJTdXBwb3J0ZWQiLCJ0cmFuc2l0aW9uTmFtZSIsInRyYW5zaXRpb25BcHBlYXIiLCJhbmltYXRpb24iLCJhcHBlYXIiLCJpc0VudGVyU3VwcG9ydGVkIiwidHJhbnNpdGlvbkVudGVyIiwiZW50ZXIiLCJpc0xlYXZlU3VwcG9ydGVkIiwidHJhbnNpdGlvbkxlYXZlIiwibGVhdmUiLCJhbGxvd0FwcGVhckNhbGxiYWNrIiwiYWxsb3dFbnRlckNhbGxiYWNrIiwiYWxsb3dMZWF2ZUNhbGxiYWNrIiwidHJhbnNpdGlvbk1hcCIsIkFuaW1hdGVDaGlsZF9BbmltYXRlQ2hpbGQiLCJfUmVhY3QkQ29tcG9uZW50IiwiQW5pbWF0ZUNoaWxkIiwiY2xhc3NDYWxsQ2hlY2tfZGVmYXVsdCIsInRoaXMiLCJwb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuX2RlZmF1bHQiLCJfX3Byb3RvX18iLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsImFwcGx5IiwiYXJndW1lbnRzIiwiaW5oZXJpdHNfZGVmYXVsdCIsImNyZWF0ZUNsYXNzX2RlZmF1bHQiLCJ2YWx1ZSIsInN0b3AiLCJkb25lIiwidHJhbnNpdGlvbiIsImFuaW1hdGlvblR5cGUiLCJmaW5pc2hDYWxsYmFjayIsIl90aGlzMiIsIm5vZGUiLCJyZWFjdF9kb21fZGVmYXVsdCIsImZpbmRET01Ob2RlIiwibmFtZUlzT2JqIiwiZW5kIiwic3RvcHBlciIsImVzIiwibmFtZSIsImFjdGl2ZU5hbWUiLCJhY3RpdmUiLCJDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJwcm9wX3R5cGVzX2RlZmF1bHQiLCJhbnkiLCJlc19BbmltYXRlQ2hpbGQiLCJkZWZhdWx0S2V5IiwiRGF0ZSIsIm5vdyIsImdldENoaWxkcmVuRnJvbVByb3BzIiwiaXNWYWxpZEVsZW1lbnQiLCJjbG9uZUVsZW1lbnQiLCJub29wIiwiQW5pbWF0ZV9BbmltYXRlIiwiQW5pbWF0ZSIsIl90aGlzIiwiY2FsbCIsIkFuaW1hdGVfaW5pdGlhbGlzZVByb3BzIiwiY3VycmVudGx5QW5pbWF0aW5nS2V5cyIsImtleXNUb0VudGVyIiwia2V5c1RvTGVhdmUiLCJzdGF0ZSIsImNoaWxkcmVuUmVmcyIsImZpbHRlciIsInBlcmZvcm1BcHBlYXIiLCJuZXh0UHJvcHMiLCJfdGhpczMiLCJuZXh0Q2hpbGRyZW4iLCJleGNsdXNpdmUiLCJrZXlzIiwibmV4dCIsIm5leHRDaGlsZHJlblBlbmRpbmciLCJwZW5kaW5nQ2hpbGRyZW4iLCJjdXJyZW50Q2hpbGRyZW4iLCJuZXdDaGlsZHJlbiIsImN1cnJlbnRDaGlsZCIsIm5leHRDaGlsZCIsIm5ld0NoaWxkIiwiZGVmaW5lUHJvcGVydHlfZGVmYXVsdCIsImxlbmd0aCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY29uY2F0Iiwic2V0U3RhdGUiLCJoYXNQcmV2Iiwic2hvd0luTmV4dCIsImhhc05leHQiLCJzaG93SW5Ob3ciLCJwZXJmb3JtRW50ZXIiLCJwZXJmb3JtTGVhdmUiLCJjb21wb25lbnQiLCJfdGhpczQiLCJzdGF0ZUNoaWxkcmVuIiwibWFwIiwiY3JlYXRlRWxlbWVudCIsInJlZiIsInBhc3NlZFByb3BzIiwiZXh0ZW5kc19kZWZhdWx0IiwiY2xhc3NOYW1lIiwic3R5bGUiLCJjb21wb25lbnRQcm9wcyIsImlzQW5pbWF0ZSIsIm9iamVjdCIsIm9uZU9mVHlwZSIsInN0cmluZyIsImJvb2wiLCJvbkVuZCIsImZ1bmMiLCJvbkVudGVyIiwib25MZWF2ZSIsIm9uQXBwZWFyIiwiZGVmYXVsdFByb3BzIiwiX3RoaXM1IiwiY29tcG9uZW50V2lsbEVudGVyIiwiaGFuZGxlRG9uZUFkZGluZyIsImJpbmQiLCJjb21wb25lbnRXaWxsQXBwZWFyIiwidHlwZSIsImlzVmFsaWRDaGlsZEJ5S2V5IiwiY29tcG9uZW50V2lsbExlYXZlIiwiaGFuZGxlRG9uZUxlYXZpbmciLCJjMSIsImMyIiwic2FtZSIsImluZGV4IiwiY2hpbGQyIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJtYXBwaW5ncyI6IjJPQUVPLFNBQUFBLEVBQUFDLEdBQ1AsSUFBQUMsRUFBQSxHQUlBLE9BSEVDLEVBQUFDLEVBQUtDLFNBQUFDLFFBQUFMLEVBQUEsU0FBQU0sR0FDUEwsRUFBQU0sS0FBQUQsS0FFQUwsRUFHTyxTQUFBTyxFQUFBUixFQUFBUyxHQUNQLElBQUFSLEVBQUEsS0FXQSxPQVZBRCxHQUNBQSxFQUFBSyxRQUFBLFNBQUFDLEdBQ0FMLEdBR0FLLEtBQUFHLFVBQ0FSLEVBQUFLLEtBSUFMLEVBR08sU0FBQVMsRUFBQVYsRUFBQVMsRUFBQUUsR0FDUCxJQUFBVixFQUFBLEtBV0EsT0FWQUQsR0FDQUEsRUFBQUssUUFBQSxTQUFBQyxHQUNBLEdBQUFBLEtBQUFHLFNBQUFILEVBQUFNLE1BQUFELEdBQUEsQ0FDQSxHQUFBVixFQUNBLFVBQUFZLE1BQUEscURBRUFaLEVBQUFLLEtBSUFMLGdDQ2pCZWEsRUFwQmYsQ0FDQUMsa0JBQUEsU0FBQUgsR0FDQSxPQUFBQSxFQUFBSSxnQkFBQUosRUFBQUssa0JBQUFMLEVBQUFNLFVBQUFDLFFBRUFDLGlCQUFBLFNB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dW5raGFzaC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmV4cG9ydCBmdW5jdGlvbiB0b0FycmF5Q2hpbGRyZW4oY2hpbGRyZW4pIHtcbiAgdmFyIHJldCA9IFtdO1xuICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICByZXQucHVzaChjaGlsZCk7XG4gIH0pO1xuICByZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZENoaWxkSW5DaGlsZHJlbkJ5S2V5KGNoaWxkcmVuLCBrZXkpIHtcbiAgdmFyIHJldCA9IG51bGw7XG4gIGlmIChjaGlsZHJlbikge1xuICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBpZiAocmV0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChjaGlsZCAmJiBjaGlsZC5rZXkgPT09IGtleSkge1xuICAgICAgICByZXQgPSBjaGlsZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFNob3duQ2hpbGRJbkNoaWxkcmVuQnlLZXkoY2hpbGRyZW4sIGtleSwgc2hvd1Byb3ApIHtcbiAgdmFyIHJldCA9IG51bGw7XG4gIGlmIChjaGlsZHJlbikge1xuICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBpZiAoY2hpbGQgJiYgY2hpbGQua2V5ID09PSBrZXkgJiYgY2hpbGQucHJvcHNbc2hvd1Byb3BdKSB7XG4gICAgICAgIGlmIChyZXQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3R3byBjaGlsZCB3aXRoIHNhbWUga2V5IGZvciA8cmMtYW5pbWF0ZT4gY2hpbGRyZW4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXQgPSBjaGlsZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZEhpZGRlbkNoaWxkSW5DaGlsZHJlbkJ5S2V5KGNoaWxkcmVuLCBrZXksIHNob3dQcm9wKSB7XG4gIHZhciBmb3VuZCA9IDA7XG4gIGlmIChjaGlsZHJlbikge1xuICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm91bmQgPSBjaGlsZCAmJiBjaGlsZC5rZXkgPT09IGtleSAmJiAhY2hpbGQucHJvcHNbc2hvd1Byb3BdO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiBmb3VuZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU2FtZUNoaWxkcmVuKGMxLCBjMiwgc2hvd1Byb3ApIHtcbiAgdmFyIHNhbWUgPSBjMS5sZW5ndGggPT09IGMyLmxlbmd0aDtcbiAgaWYgKHNhbWUpIHtcbiAgICBjMS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCwgaW5kZXgpIHtcbiAgICAgIHZhciBjaGlsZDIgPSBjMltpbmRleF07XG4gICAgICBpZiAoY2hpbGQgJiYgY2hpbGQyKSB7XG4gICAgICAgIGlmIChjaGlsZCAmJiAhY2hpbGQyIHx8ICFjaGlsZCAmJiBjaGlsZDIpIHtcbiAgICAgICAgICBzYW1lID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoY2hpbGQua2V5ICE9PSBjaGlsZDIua2V5KSB7XG4gICAgICAgICAgc2FtZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKHNob3dQcm9wICYmIGNoaWxkLnByb3BzW3Nob3dQcm9wXSAhPT0gY2hpbGQyLnByb3BzW3Nob3dQcm9wXSkge1xuICAgICAgICAgIHNhbWUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBzYW1lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VDaGlsZHJlbihwcmV2LCBuZXh0KSB7XG4gIHZhciByZXQgPSBbXTtcblxuICAvLyBGb3IgZWFjaCBrZXkgb2YgYG5leHRgLCB0aGUgbGlzdCBvZiBrZXlzIHRvIGluc2VydCBiZWZvcmUgdGhhdCBrZXkgaW5cbiAgLy8gdGhlIGNvbWJpbmVkIGxpc3RcbiAgdmFyIG5leHRDaGlsZHJlblBlbmRpbmcgPSB7fTtcbiAgdmFyIHBlbmRpbmdDaGlsZHJlbiA9IFtdO1xuICBwcmV2LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgaWYgKGNoaWxkICYmIGZpbmRDaGlsZEluQ2hpbGRyZW5CeUtleShuZXh0LCBjaGlsZC5rZXkpKSB7XG4gICAgICBpZiAocGVuZGluZ0NoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICBuZXh0Q2hpbGRyZW5QZW5kaW5nW2NoaWxkLmtleV0gPSBwZW5kaW5nQ2hpbGRyZW47XG4gICAgICAgIHBlbmRpbmdDaGlsZHJlbiA9IFtdO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBwZW5kaW5nQ2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgfVxuICB9KTtcblxuICBuZXh0LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgaWYgKGNoaWxkICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuZXh0Q2hpbGRyZW5QZW5kaW5nLCBjaGlsZC5rZXkpKSB7XG4gICAgICByZXQgPSByZXQuY29uY2F0KG5leHRDaGlsZHJlblBlbmRpbmdbY2hpbGQua2V5XSk7XG4gICAgfVxuICAgIHJldC5wdXNoKGNoaWxkKTtcbiAgfSk7XG5cbiAgcmV0ID0gcmV0LmNvbmNhdChwZW5kaW5nQ2hpbGRyZW4pO1xuXG4gIHJldHVybiByZXQ7XG59IiwidmFyIHV0aWwgPSB7XG4gIGlzQXBwZWFyU3VwcG9ydGVkOiBmdW5jdGlvbiBpc0FwcGVhclN1cHBvcnRlZChwcm9wcykge1xuICAgIHJldHVybiBwcm9wcy50cmFuc2l0aW9uTmFtZSAmJiBwcm9wcy50cmFuc2l0aW9uQXBwZWFyIHx8IHByb3BzLmFuaW1hdGlvbi5hcHBlYXI7XG4gIH0sXG4gIGlzRW50ZXJTdXBwb3J0ZWQ6IGZ1bmN0aW9uIGlzRW50ZXJTdXBwb3J0ZWQocHJvcHMpIHtcbiAgICByZXR1cm4gcHJvcHMudHJhbnNpdGlvbk5hbWUgJiYgcHJvcHMudHJhbnNpdGlvbkVudGVyIHx8IHByb3BzLmFuaW1hdGlvbi5lbnRlcjtcbiAgfSxcbiAgaXNMZWF2ZVN1cHBvcnRlZDogZnVuY3Rpb24gaXNMZWF2ZVN1cHBvcnRlZChwcm9wcykge1xuICAgIHJldHVybiBwcm9wcy50cmFuc2l0aW9uTmFtZSAmJiBwcm9wcy50cmFuc2l0aW9uTGVhdmUgfHwgcHJvcHMuYW5pbWF0aW9uLmxlYXZlO1xuICB9LFxuICBhbGxvd0FwcGVhckNhbGxiYWNrOiBmdW5jdGlvbiBhbGxvd0FwcGVhckNhbGxiYWNrKHByb3BzKSB7XG4gICAgcmV0dXJuIHByb3BzLnRyYW5zaXRpb25BcHBlYXIgfHwgcHJvcHMuYW5pbWF0aW9uLmFwcGVhcjtcbiAgfSxcbiAgYWxsb3dFbnRlckNhbGxiYWNrOiBmdW5jdGlvbiBhbGxvd0VudGVyQ2FsbGJhY2socHJvcHMpIHtcbiAgICByZXR1cm4gcHJvcHMudHJhbnNpdGlvbkVudGVyIHx8IHByb3BzLmFuaW1hdGlvbi5lbnRlcjtcbiAgfSxcbiAgYWxsb3dMZWF2ZUNhbGxiYWNrOiBmdW5jdGlvbiBhbGxvd0xlYXZlQ2FsbGJhY2socHJvcHMpIHtcbiAgICByZXR1cm4gcHJvcHMudHJhbnNpdGlvbkxlYXZlIHx8IHByb3BzLmFuaW1hdGlvbi5sZWF2ZTtcbiAgfVxufTtcbmV4cG9ydCBkZWZhdWx0IHV0aWw7IiwiaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2snO1xuaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MnO1xuaW1wb3J0IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIGZyb20gJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuJztcbmltcG9ydCBfaW5oZXJpdHMgZnJvbSAnYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgY3NzQW5pbWF0ZSwgeyBpc0Nzc0FuaW1hdGlvblN1cHBvcnRlZCB9IGZyb20gJ2Nzcy1hbmltYXRpb24nO1xuaW1wb3J0IGFuaW1VdGlsIGZyb20gJy4vdXRpbC9hbmltYXRlJztcblxudmFyIHRyYW5zaXRpb25NYXAgPSB7XG4gIGVudGVyOiAndHJhbnNpdGlvbkVudGVyJyxcbiAgYXBwZWFyOiAndHJhbnNpdGlvbkFwcGVhcicsXG4gIGxlYXZlOiAndHJhbnNpdGlvbkxlYXZlJ1xufTtcblxudmFyIEFuaW1hdGVDaGlsZCA9IGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gIF9pbmhlcml0cyhBbmltYXRlQ2hpbGQsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gIGZ1bmN0aW9uIEFuaW1hdGVDaGlsZCgpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQW5pbWF0ZUNoaWxkKTtcblxuICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoQW5pbWF0ZUNoaWxkLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoQW5pbWF0ZUNoaWxkKSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoQW5pbWF0ZUNoaWxkLCBbe1xuICAgIGtleTogJ2NvbXBvbmVudFdpbGxVbm1vdW50JyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICB0aGlzLnN0b3AoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdjb21wb25lbnRXaWxsRW50ZXInLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsRW50ZXIoZG9uZSkge1xuICAgICAgaWYgKGFuaW1VdGlsLmlzRW50ZXJTdXBwb3J0ZWQodGhpcy5wcm9wcykpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uKCdlbnRlcicsIGRvbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2NvbXBvbmVudFdpbGxBcHBlYXInLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsQXBwZWFyKGRvbmUpIHtcbiAgICAgIGlmIChhbmltVXRpbC5pc0FwcGVhclN1cHBvcnRlZCh0aGlzLnByb3BzKSkge1xuICAgICAgICB0aGlzLnRyYW5zaXRpb24oJ2FwcGVhcicsIGRvbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2NvbXBvbmVudFdpbGxMZWF2ZScsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxMZWF2ZShkb25lKSB7XG4gICAgICBpZiAoYW5pbVV0aWwuaXNMZWF2ZVN1cHBvcnRlZCh0aGlzLnByb3BzKSkge1xuICAgICAgICB0aGlzLnRyYW5zaXRpb24oJ2xlYXZlJywgZG9uZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhbHdheXMgc3luYywgZG8gbm90IGludGVydXB0IHdpdGggcmVhY3QgY29tcG9uZW50IGxpZmUgY3ljbGVcbiAgICAgICAgLy8gdXBkYXRlIGhpZGRlbiAtPiBhbmltYXRlIGhpZGRlbiAtPlxuICAgICAgICAvLyBkaWRVcGRhdGUgLT4gYW5pbWF0ZSBsZWF2ZSAtPiB1bm1vdW50IChpZiBhbmltYXRlIGlzIG5vbmUpXG4gICAgICAgIGRvbmUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICd0cmFuc2l0aW9uJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gdHJhbnNpdGlvbihhbmltYXRpb25UeXBlLCBmaW5pc2hDYWxsYmFjaykge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHZhciBub2RlID0gUmVhY3RET00uZmluZERPTU5vZGUodGhpcyk7XG4gICAgICB2YXIgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgICAgdmFyIHRyYW5zaXRpb25OYW1lID0gcHJvcHMudHJhbnNpdGlvbk5hbWU7XG4gICAgICB2YXIgbmFtZUlzT2JqID0gdHlwZW9mIHRyYW5zaXRpb25OYW1lID09PSAnb2JqZWN0JztcbiAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgdmFyIGVuZCA9IGZ1bmN0aW9uIGVuZCgpIHtcbiAgICAgICAgX3RoaXMyLnN0b3BwZXIgPSBudWxsO1xuICAgICAgICBmaW5pc2hDYWxsYmFjaygpO1xuICAgICAgfTtcbiAgICAgIGlmICgoaXNDc3NBbmltYXRpb25TdXBwb3J0ZWQgfHwgIXByb3BzLmFuaW1hdGlvblthbmltYXRpb25UeXBlXSkgJiYgdHJhbnNpdGlvbk5hbWUgJiYgcHJvcHNbdHJhbnNpdGlvbk1hcFthbmltYXRpb25UeXBlXV0pIHtcbiAgICAgICAgdmFyIG5hbWUgPSBuYW1lSXNPYmogPyB0cmFuc2l0aW9uTmFtZVthbmltYXRpb25UeXBlXSA6IHRyYW5zaXRpb25OYW1lICsgJy0nICsgYW5pbWF0aW9uVHlwZTtcbiAgICAgICAgdmFyIGFjdGl2ZU5hbWUgPSBuYW1lICsgJy1hY3RpdmUnO1xuICAgICAgICBpZiAobmFtZUlzT2JqICYmIHRyYW5zaXRpb25OYW1lW2FuaW1hdGlvblR5cGUgKyAnQWN0aXZlJ10pIHtcbiAgICAgICAgICBhY3RpdmVOYW1lID0gdHJhbnNpdGlvbk5hbWVbYW5pbWF0aW9uVHlwZSArICdBY3RpdmUnXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0b3BwZXIgPSBjc3NBbmltYXRlKG5vZGUsIHtcbiAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgIGFjdGl2ZTogYWN0aXZlTmFtZVxuICAgICAgICB9LCBlbmQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zdG9wcGVyID0gcHJvcHMuYW5pbWF0aW9uW2FuaW1hdGlvblR5cGVdKG5vZGUsIGVuZCk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnc3RvcCcsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICB2YXIgc3RvcHBlciA9IHRoaXMuc3RvcHBlcjtcbiAgICAgIGlmIChzdG9wcGVyKSB7XG4gICAgICAgIHRoaXMuc3RvcHBlciA9IG51bGw7XG4gICAgICAgIHN0b3BwZXIuc3RvcCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3JlbmRlcicsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLmNoaWxkcmVuO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBBbmltYXRlQ2hpbGQ7XG59KFJlYWN0LkNvbXBvbmVudCk7XG5cbkFuaW1hdGVDaGlsZC5wcm9wVHlwZXMgPSB7XG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55XG59O1xuZXhwb3J0IGRlZmF1bHQgQW5pbWF0ZUNoaWxkOyIsImltcG9ydCBfZXh0ZW5kcyBmcm9tICdiYWJlbC1ydW50aW1lL2hlbHBlcnMvZXh0ZW5kcyc7XG5pbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eSc7XG5pbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayc7XG5pbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyc7XG5pbXBvcnQgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gZnJvbSAnYmFiZWwtcnVudGltZS9oZWxwZXJzL3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4nO1xuaW1wb3J0IF9pbmhlcml0cyBmcm9tICdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyB0b0FycmF5Q2hpbGRyZW4sIG1lcmdlQ2hpbGRyZW4sIGZpbmRTaG93bkNoaWxkSW5DaGlsZHJlbkJ5S2V5LCBmaW5kQ2hpbGRJbkNoaWxkcmVuQnlLZXksIGlzU2FtZUNoaWxkcmVuIH0gZnJvbSAnLi9DaGlsZHJlblV0aWxzJztcbmltcG9ydCBBbmltYXRlQ2hpbGQgZnJvbSAnLi9BbmltYXRlQ2hpbGQnO1xuaW1wb3J0IGFuaW1VdGlsIGZyb20gJy4vdXRpbC9hbmltYXRlJztcblxudmFyIGRlZmF1bHRLZXkgPSAncmNfYW5pbWF0ZV8nICsgRGF0ZS5ub3coKTtcblxuZnVuY3Rpb24gZ2V0Q2hpbGRyZW5Gcm9tUHJvcHMocHJvcHMpIHtcbiAgdmFyIGNoaWxkcmVuID0gcHJvcHMuY2hpbGRyZW47XG4gIGlmIChSZWFjdC5pc1ZhbGlkRWxlbWVudChjaGlsZHJlbikpIHtcbiAgICBpZiAoIWNoaWxkcmVuLmtleSkge1xuICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZHJlbiwge1xuICAgICAgICBrZXk6IGRlZmF1bHRLZXlcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY2hpbGRyZW47XG59XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG52YXIgQW5pbWF0ZSA9IGZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gIF9pbmhlcml0cyhBbmltYXRlLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cbiAgZnVuY3Rpb24gQW5pbWF0ZShwcm9wcykge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBbmltYXRlKTtcblxuICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChBbmltYXRlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoQW5pbWF0ZSkpLmNhbGwodGhpcywgcHJvcHMpKTtcblxuICAgIF9pbml0aWFsaXNlUHJvcHMuY2FsbChfdGhpcyk7XG5cbiAgICBfdGhpcy5jdXJyZW50bHlBbmltYXRpbmdLZXlzID0ge307XG4gICAgX3RoaXMua2V5c1RvRW50ZXIgPSBbXTtcbiAgICBfdGhpcy5rZXlzVG9MZWF2ZSA9IFtdO1xuXG4gICAgX3RoaXMuc3RhdGUgPSB7XG4gICAgICBjaGlsZHJlbjogdG9BcnJheUNoaWxkcmVuKGdldENoaWxkcmVuRnJvbVByb3BzKHByb3BzKSlcbiAgICB9O1xuXG4gICAgX3RoaXMuY2hpbGRyZW5SZWZzID0ge307XG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKEFuaW1hdGUsIFt7XG4gICAga2V5OiAnY29tcG9uZW50RGlkTW91bnQnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB2YXIgc2hvd1Byb3AgPSB0aGlzLnByb3BzLnNob3dQcm9wO1xuICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5zdGF0ZS5jaGlsZHJlbjtcbiAgICAgIGlmIChzaG93UHJvcCkge1xuICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICByZXR1cm4gISFjaGlsZC5wcm9wc1tzaG93UHJvcF07XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgaWYgKGNoaWxkKSB7XG4gICAgICAgICAgX3RoaXMyLnBlcmZvcm1BcHBlYXIoY2hpbGQua2V5KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgdGhpcy5uZXh0UHJvcHMgPSBuZXh0UHJvcHM7XG4gICAgICB2YXIgbmV4dENoaWxkcmVuID0gdG9BcnJheUNoaWxkcmVuKGdldENoaWxkcmVuRnJvbVByb3BzKG5leHRQcm9wcykpO1xuICAgICAgdmFyIHByb3BzID0gdGhpcy5wcm9wcztcbiAgICAgIC8vIGV4Y2x1c2l2ZSBuZWVkcyBpbW1lZGlhdGUgcmVzcG9uc2VcbiAgICAgIGlmIChwcm9wcy5leGNsdXNpdmUpIHtcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5jdXJyZW50bHlBbmltYXRpbmdLZXlzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICBfdGhpczMuc3RvcChrZXkpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHZhciBzaG93UHJvcCA9IHByb3BzLnNob3dQcm9wO1xuICAgICAgdmFyIGN1cnJlbnRseUFuaW1hdGluZ0tleXMgPSB0aGlzLmN1cnJlbnRseUFuaW1hdGluZ0tleXM7XG4gICAgICAvLyBsYXN0IHByb3BzIGNoaWxkcmVuIGlmIGV4Y2x1c2l2ZVxuICAgICAgdmFyIGN1cnJlbnRDaGlsZHJlbiA9IHByb3BzLmV4Y2x1c2l2ZSA/IHRvQXJyYXlDaGlsZHJlbihnZXRDaGlsZHJlbkZyb21Qcm9wcyhwcm9wcykpIDogdGhpcy5zdGF0ZS5jaGlsZHJlbjtcbiAgICAgIC8vIGluIGNhc2UgZGVzdHJveSBpbiBzaG93UHJvcCBtb2RlXG4gICAgICB2YXIgbmV3Q2hpbGRyZW4gPSBbXTtcbiAgICAgIGlmIChzaG93UHJvcCkge1xuICAgICAgICBjdXJyZW50Q2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY3VycmVudENoaWxkKSB7XG4gICAgICAgICAgdmFyIG5leHRDaGlsZCA9IGN1cnJlbnRDaGlsZCAmJiBmaW5kQ2hpbGRJbkNoaWxkcmVuQnlLZXkobmV4dENoaWxkcmVuLCBjdXJyZW50Q2hpbGQua2V5KTtcbiAgICAgICAgICB2YXIgbmV3Q2hpbGQgPSB2b2lkIDA7XG4gICAgICAgICAgaWYgKCghbmV4dENoaWxkIHx8ICFuZXh0Q2hpbGQucHJvcHNbc2hvd1Byb3BdKSAmJiBjdXJyZW50Q2hpbGQucHJvcHNbc2hvd1Byb3BdKSB7XG4gICAgICAgICAgICBuZXdDaGlsZCA9IFJlYWN0LmNsb25lRWxlbWVudChuZXh0Q2hpbGQgfHwgY3VycmVudENoaWxkLCBfZGVmaW5lUHJvcGVydHkoe30sIHNob3dQcm9wLCB0cnVlKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld0NoaWxkID0gbmV4dENoaWxkO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobmV3Q2hpbGQpIHtcbiAgICAgICAgICAgIG5ld0NoaWxkcmVuLnB1c2gobmV3Q2hpbGQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIG5leHRDaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChuZXh0Q2hpbGQpIHtcbiAgICAgICAgICBpZiAoIW5leHRDaGlsZCB8fCAhZmluZENoaWxkSW5DaGlsZHJlbkJ5S2V5KGN1cnJlbnRDaGlsZHJlbiwgbmV4dENoaWxkLmtleSkpIHtcbiAgICAgICAgICAgIG5ld0NoaWxkcmVuLnB1c2gobmV4dENoaWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3Q2hpbGRyZW4gPSBtZXJnZUNoaWxkcmVuKGN1cnJlbnRDaGlsZHJlbiwgbmV4dENoaWxkcmVuKTtcbiAgICAgIH1cblxuICAgICAgLy8gbmVlZCByZW5kZXIgdG8gYXZvaWQgdXBkYXRlXG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgY2hpbGRyZW46IG5ld0NoaWxkcmVuXG4gICAgICB9KTtcblxuICAgICAgbmV4dENoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgIHZhciBrZXkgPSBjaGlsZCAmJiBjaGlsZC5rZXk7XG4gICAgICAgIGlmIChjaGlsZCAmJiBjdXJyZW50bHlBbmltYXRpbmdLZXlzW2tleV0pIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhhc1ByZXYgPSBjaGlsZCAmJiBmaW5kQ2hpbGRJbkNoaWxkcmVuQnlLZXkoY3VycmVudENoaWxkcmVuLCBrZXkpO1xuICAgICAgICBpZiAoc2hvd1Byb3ApIHtcbiAgICAgICAgICB2YXIgc2hvd0luTmV4dCA9IGNoaWxkLnByb3BzW3Nob3dQcm9wXTtcbiAgICAgICAgICBpZiAoaGFzUHJldikge1xuICAgICAgICAgICAgdmFyIHNob3dJbk5vdyA9IGZpbmRTaG93bkNoaWxkSW5DaGlsZHJlbkJ5S2V5KGN1cnJlbnRDaGlsZHJlbiwga2V5LCBzaG93UHJvcCk7XG4gICAgICAgICAgICBpZiAoIXNob3dJbk5vdyAmJiBzaG93SW5OZXh0KSB7XG4gICAgICAgICAgICAgIF90aGlzMy5rZXlzVG9FbnRlci5wdXNoKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChzaG93SW5OZXh0KSB7XG4gICAgICAgICAgICBfdGhpczMua2V5c1RvRW50ZXIucHVzaChrZXkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghaGFzUHJldikge1xuICAgICAgICAgIF90aGlzMy5rZXlzVG9FbnRlci5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBjdXJyZW50Q2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgdmFyIGtleSA9IGNoaWxkICYmIGNoaWxkLmtleTtcbiAgICAgICAgaWYgKGNoaWxkICYmIGN1cnJlbnRseUFuaW1hdGluZ0tleXNba2V5XSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaGFzTmV4dCA9IGNoaWxkICYmIGZpbmRDaGlsZEluQ2hpbGRyZW5CeUtleShuZXh0Q2hpbGRyZW4sIGtleSk7XG4gICAgICAgIGlmIChzaG93UHJvcCkge1xuICAgICAgICAgIHZhciBzaG93SW5Ob3cgPSBjaGlsZC5wcm9wc1tzaG93UHJvcF07XG4gICAgICAgICAgaWYgKGhhc05leHQpIHtcbiAgICAgICAgICAgIHZhciBzaG93SW5OZXh0ID0gZmluZFNob3duQ2hpbGRJbkNoaWxkcmVuQnlLZXkobmV4dENoaWxkcmVuLCBrZXksIHNob3dQcm9wKTtcbiAgICAgICAgICAgIGlmICghc2hvd0luTmV4dCAmJiBzaG93SW5Ob3cpIHtcbiAgICAgICAgICAgICAgX3RoaXMzLmtleXNUb0xlYXZlLnB1c2goa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKHNob3dJbk5vdykge1xuICAgICAgICAgICAgX3RoaXMzLmtleXNUb0xlYXZlLnB1c2goa2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWhhc05leHQpIHtcbiAgICAgICAgICBfdGhpczMua2V5c1RvTGVhdmUucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdjb21wb25lbnREaWRVcGRhdGUnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICB2YXIga2V5c1RvRW50ZXIgPSB0aGlzLmtleXNUb0VudGVyO1xuICAgICAgdGhpcy5rZXlzVG9FbnRlciA9IFtdO1xuICAgICAga2V5c1RvRW50ZXIuZm9yRWFjaCh0aGlzLnBlcmZvcm1FbnRlcik7XG4gICAgICB2YXIga2V5c1RvTGVhdmUgPSB0aGlzLmtleXNUb0xlYXZlO1xuICAgICAgdGhpcy5rZXlzVG9MZWF2ZSA9IFtdO1xuICAgICAga2V5c1RvTGVhdmUuZm9yRWFjaCh0aGlzLnBlcmZvcm1MZWF2ZSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnaXNWYWxpZENoaWxkQnlLZXknLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpc1ZhbGlkQ2hpbGRCeUtleShjdXJyZW50Q2hpbGRyZW4sIGtleSkge1xuICAgICAgdmFyIHNob3dQcm9wID0gdGhpcy5wcm9wcy5zaG93UHJvcDtcbiAgICAgIGlmIChzaG93UHJvcCkge1xuICAgICAgICByZXR1cm4gZmluZFNob3duQ2hpbGRJbkNoaWxkcmVuQnlLZXkoY3VycmVudENoaWxkcmVuLCBrZXksIHNob3dQcm9wKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmaW5kQ2hpbGRJbkNoaWxkcmVuQnlLZXkoY3VycmVudENoaWxkcmVuLCBrZXkpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3N0b3AnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKGtleSkge1xuICAgICAgZGVsZXRlIHRoaXMuY3VycmVudGx5QW5pbWF0aW5nS2V5c1trZXldO1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXMuY2hpbGRyZW5SZWZzW2tleV07XG4gICAgICBpZiAoY29tcG9uZW50KSB7XG4gICAgICAgIGNvbXBvbmVudC5zdG9wKCk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAncmVuZGVyJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICAgIHZhciBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICB0aGlzLm5leHRQcm9wcyA9IHByb3BzO1xuICAgICAgdmFyIHN0YXRlQ2hpbGRyZW4gPSB0aGlzLnN0YXRlLmNoaWxkcmVuO1xuICAgICAgdmFyIGNoaWxkcmVuID0gbnVsbDtcbiAgICAgIGlmIChzdGF0ZUNoaWxkcmVuKSB7XG4gICAgICAgIGNoaWxkcmVuID0gc3RhdGVDaGlsZHJlbi5tYXAoZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgICAgaWYgKGNoaWxkID09PSBudWxsIHx8IGNoaWxkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFjaGlsZC5rZXkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbXVzdCBzZXQga2V5IGZvciA8cmMtYW5pbWF0ZT4gY2hpbGRyZW4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBBbmltYXRlQ2hpbGQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGtleTogY2hpbGQua2V5LFxuICAgICAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihub2RlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXM0LmNoaWxkcmVuUmVmc1tjaGlsZC5rZXldID0gbm9kZTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYW5pbWF0aW9uOiBwcm9wcy5hbmltYXRpb24sXG4gICAgICAgICAgICAgIHRyYW5zaXRpb25OYW1lOiBwcm9wcy50cmFuc2l0aW9uTmFtZSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbkVudGVyOiBwcm9wcy50cmFuc2l0aW9uRW50ZXIsXG4gICAgICAgICAgICAgIHRyYW5zaXRpb25BcHBlYXI6IHByb3BzLnRyYW5zaXRpb25BcHBlYXIsXG4gICAgICAgICAgICAgIHRyYW5zaXRpb25MZWF2ZTogcHJvcHMudHJhbnNpdGlvbkxlYXZlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHZhciBDb21wb25lbnQgPSBwcm9wcy5jb21wb25lbnQ7XG4gICAgICBpZiAoQ29tcG9uZW50KSB7XG4gICAgICAgIHZhciBwYXNzZWRQcm9wcyA9IHByb3BzO1xuICAgICAgICBpZiAodHlwZW9mIENvbXBvbmVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBwYXNzZWRQcm9wcyA9IF9leHRlbmRzKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogcHJvcHMuY2xhc3NOYW1lLFxuICAgICAgICAgICAgc3R5bGU6IHByb3BzLnN0eWxlXG4gICAgICAgICAgfSwgcHJvcHMuY29tcG9uZW50UHJvcHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIENvbXBvbmVudCxcbiAgICAgICAgICBwYXNzZWRQcm9wcyxcbiAgICAgICAgICBjaGlsZHJlblxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoaWxkcmVuWzBdIHx8IG51bGw7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEFuaW1hdGU7XG59KFJlYWN0LkNvbXBvbmVudCk7XG5cbkFuaW1hdGUuaXNBbmltYXRlID0gdHJ1ZTtcbkFuaW1hdGUucHJvcFR5cGVzID0ge1xuICBjb21wb25lbnQ6IFByb3BUeXBlcy5hbnksXG4gIGNvbXBvbmVudFByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuICBhbmltYXRpb246IFByb3BUeXBlcy5vYmplY3QsXG4gIHRyYW5zaXRpb25OYW1lOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMub2JqZWN0XSksXG4gIHRyYW5zaXRpb25FbnRlcjogUHJvcFR5cGVzLmJvb2wsXG4gIHRyYW5zaXRpb25BcHBlYXI6IFByb3BUeXBlcy5ib29sLFxuICBleGNsdXNpdmU6IFByb3BUeXBlcy5ib29sLFxuICB0cmFuc2l0aW9uTGVhdmU6IFByb3BUeXBlcy5ib29sLFxuICBvbkVuZDogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uRW50ZXI6IFByb3BUeXBlcy5mdW5jLFxuICBvbkxlYXZlOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25BcHBlYXI6IFByb3BUeXBlcy5mdW5jLFxuICBzaG93UHJvcDogUHJvcFR5cGVzLnN0cmluZyxcbiAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlXG59O1xuQW5pbWF0ZS5kZWZhdWx0UHJvcHMgPSB7XG4gIGFuaW1hdGlvbjoge30sXG4gIGNvbXBvbmVudDogJ3NwYW4nLFxuICBjb21wb25lbnRQcm9wczoge30sXG4gIHRyYW5zaXRpb25FbnRlcjogdHJ1ZSxcbiAgdHJhbnNpdGlvbkxlYXZlOiB0cnVlLFxuICB0cmFuc2l0aW9uQXBwZWFyOiBmYWxzZSxcbiAgb25FbmQ6IG5vb3AsXG4gIG9uRW50ZXI6IG5vb3AsXG4gIG9uTGVhdmU6IG5vb3AsXG4gIG9uQXBwZWFyOiBub29wXG59O1xuXG52YXIgX2luaXRpYWxpc2VQcm9wcyA9IGZ1bmN0aW9uIF9pbml0aWFsaXNlUHJvcHMoKSB7XG4gIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gIHRoaXMucGVyZm9ybUVudGVyID0gZnVuY3Rpb24gKGtleSkge1xuICAgIC8vIG1heSBhbHJlYWR5IHJlbW92ZSBieSBleGNsdXNpdmVcbiAgICBpZiAoX3RoaXM1LmNoaWxkcmVuUmVmc1trZXldKSB7XG4gICAgICBfdGhpczUuY3VycmVudGx5QW5pbWF0aW5nS2V5c1trZXldID0gdHJ1ZTtcbiAgICAgIF90aGlzNS5jaGlsZHJlblJlZnNba2V5XS5jb21wb25lbnRXaWxsRW50ZXIoX3RoaXM1LmhhbmRsZURvbmVBZGRpbmcuYmluZChfdGhpczUsIGtleSwgJ2VudGVyJykpO1xuICAgIH1cbiAgfTtcblxuICB0aGlzLnBlcmZvcm1BcHBlYXIgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKF90aGlzNS5jaGlsZHJlblJlZnNba2V5XSkge1xuICAgICAgX3RoaXM1LmN1cnJlbnRseUFuaW1hdGluZ0tleXNba2V5XSA9IHRydWU7XG4gICAgICBfdGhpczUuY2hpbGRyZW5SZWZzW2tleV0uY29tcG9uZW50V2lsbEFwcGVhcihfdGhpczUuaGFuZGxlRG9uZUFkZGluZy5iaW5kKF90aGlzNSwga2V5LCAnYXBwZWFyJykpO1xuICAgIH1cbiAgfTtcblxuICB0aGlzLmhhbmRsZURvbmVBZGRpbmcgPSBmdW5jdGlvbiAoa2V5LCB0eXBlKSB7XG4gICAgdmFyIHByb3BzID0gX3RoaXM1LnByb3BzO1xuICAgIGRlbGV0ZSBfdGhpczUuY3VycmVudGx5QW5pbWF0aW5nS2V5c1trZXldO1xuICAgIC8vIGlmIHVwZGF0ZSBvbiBleGNsdXNpdmUgbW9kZSwgc2tpcCBjaGVja1xuICAgIGlmIChwcm9wcy5leGNsdXNpdmUgJiYgcHJvcHMgIT09IF90aGlzNS5uZXh0UHJvcHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGN1cnJlbnRDaGlsZHJlbiA9IHRvQXJyYXlDaGlsZHJlbihnZXRDaGlsZHJlbkZyb21Qcm9wcyhwcm9wcykpO1xuICAgIGlmICghX3RoaXM1LmlzVmFsaWRDaGlsZEJ5S2V5KGN1cnJlbnRDaGlsZHJlbiwga2V5KSkge1xuICAgICAgLy8gZXhjbHVzaXZlIHdpbGwgbm90IG5lZWQgdGhpc1xuICAgICAgX3RoaXM1LnBlcmZvcm1MZWF2ZShrZXkpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2FwcGVhcicpIHtcbiAgICAgIGlmIChhbmltVXRpbC5hbGxvd0FwcGVhckNhbGxiYWNrKHByb3BzKSkge1xuICAgICAgICBwcm9wcy5vbkFwcGVhcihrZXkpO1xuICAgICAgICBwcm9wcy5vbkVuZChrZXksIHRydWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYW5pbVV0aWwuYWxsb3dFbnRlckNhbGxiYWNrKHByb3BzKSkge1xuICAgICAgcHJvcHMub25FbnRlcihrZXkpO1xuICAgICAgcHJvcHMub25FbmQoa2V5LCB0cnVlKTtcbiAgICB9XG4gIH07XG5cbiAgdGhpcy5wZXJmb3JtTGVhdmUgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgLy8gbWF5IGFscmVhZHkgcmVtb3ZlIGJ5IGV4Y2x1c2l2ZVxuICAgIGlmIChfdGhpczUuY2hpbGRyZW5SZWZzW2tleV0pIHtcbiAgICAgIF90aGlzNS5jdXJyZW50bHlBbmltYXRpbmdLZXlzW2tleV0gPSB0cnVlO1xuICAgICAgX3RoaXM1LmNoaWxkcmVuUmVmc1trZXldLmNvbXBvbmVudFdpbGxMZWF2ZShfdGhpczUuaGFuZGxlRG9uZUxlYXZpbmcuYmluZChfdGhpczUsIGtleSkpO1xuICAgIH1cbiAgfTtcblxuICB0aGlzLmhhbmRsZURvbmVMZWF2aW5nID0gZnVuY3Rpb24gKGtleSkge1xuICAgIHZhciBwcm9wcyA9IF90aGlzNS5wcm9wcztcbiAgICBkZWxldGUgX3RoaXM1LmN1cnJlbnRseUFuaW1hdGluZ0tleXNba2V5XTtcbiAgICAvLyBpZiB1cGRhdGUgb24gZXhjbHVzaXZlIG1vZGUsIHNraXAgY2hlY2tcbiAgICBpZiAocHJvcHMuZXhjbHVzaXZlICYmIHByb3BzICE9PSBfdGhpczUubmV4dFByb3BzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjdXJyZW50Q2hpbGRyZW4gPSB0b0FycmF5Q2hpbGRyZW4oZ2V0Q2hpbGRyZW5Gcm9tUHJvcHMocHJvcHMpKTtcbiAgICAvLyBpbiBjYXNlIHN0YXRlIGNoYW5nZSBpcyB0b28gZmFzdFxuICAgIGlmIChfdGhpczUuaXNWYWxpZENoaWxkQnlLZXkoY3VycmVudENoaWxkcmVuLCBrZXkpKSB7XG4gICAgICBfdGhpczUucGVyZm9ybUVudGVyKGtleSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBlbmQgPSBmdW5jdGlvbiBlbmQoKSB7XG4gICAgICAgIGlmIChhbmltVXRpbC5hbGxvd0xlYXZlQ2FsbGJhY2socHJvcHMpKSB7XG4gICAgICAgICAgcHJvcHMub25MZWF2ZShrZXkpO1xuICAgICAgICAgIHByb3BzLm9uRW5kKGtleSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaWYgKCFpc1NhbWVDaGlsZHJlbihfdGhpczUuc3RhdGUuY2hpbGRyZW4sIGN1cnJlbnRDaGlsZHJlbiwgcHJvcHMuc2hvd1Byb3ApKSB7XG4gICAgICAgIF90aGlzNS5zZXRTdGF0ZSh7XG4gICAgICAgICAgY2hpbGRyZW46IGN1cnJlbnRDaGlsZHJlblxuICAgICAgICB9LCBlbmQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW5kKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgQW5pbWF0ZTsiXSwic291cmNlUm9vdCI6IiJ9